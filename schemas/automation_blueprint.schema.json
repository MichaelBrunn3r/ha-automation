{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http://github.com/MichaelBrunn3r/ha-blueprints/schemas/automation_blueprint.schema.json",
  "title": "Home Assistant Automation Blueprint Schema",
  "type": "object",
  "properties": {
    "blueprint": {
      "$ref": "blueprint_metadata.schema.json"
    },
    "alias": {
      "description": "Friendly name for the automation.",
      "type": "string"
    },
    "id": {
      "description": "A unique id for your automation, will allow you to make changes to the name and entity_id in the UI, and will enable debug traces.",
      "type": "string"
    },
    "description": {
      "description": "A description of the automation.",
      "type": "string"
    },
    "initial_state": {
      "description": "Used to define the state of your automation at startup. When not set, the state will be restored from the last run. See Automation initial state.",
      "type": "boolean"
    },
    "trace": {
      "description": "Configuration values for the traces stored, currently only 'stored_traces' can be configured.",
      "type": "object",
      "default": {},
      "properties": {
        "stored_traces": {
          "description": "The number of traces which will be stored. See Number of debug traces stored.",
          "type": "integer",
          "default": 5
        }
      }
    },
    "variables": {
      "description": "Variables that will be available inside the templates, both in 'condition' and 'action'.",
      "type": "object",
      "default": {},
      "patternProperties": {
        ".+": {
          "description": "A variable. Any YAML is valid. Templates can also be used to pass a value to the variable."
        }
      }
    },
    "trigger_variables": {
      "description": "Variables that will be available inside your templates triggers.",
      "type": "object",
      "default": {},
      "patternProperties": {
        ".+": {
          "description": "A variable. Any YAML is valid. Only limited templates can be used."
        }
      }
    },
    "mode": {
      "description": "Controls what happens when the automation is invoked while it is still running from one or more previous invocations. See Automation Modes.",
      "enum": [
        "single",
        "restart",
        "queued",
        "parallel"
      ],
      "default": "single",
      "$comment": "https://www.home-assistant.io/docs/automation/yaml/#mode"
    },
    "max": {
      "description": "Controls maximum number of runs executing and/or queued up to run at a time. Only valid with modes 'queued' and 'parallel'.",
      "type": "integer",
      "default": 10
    },
    "max_exceeded": {
      "description": "When 'max' is exceeded (which is effectively 1 for 'single' mode) a log message will be emitted to indicate this has happened. This option controls the severity level of that log message. See Log Levels for a list of valid options. Or 'silent' may be specified to suppress the message from being emitted.",
      "type": "string"
    },
    "trigger": {
      "description": "The trigger(s) which will start the automation. Multiple triggers can be added and the automation will start when any of these triggers trigger.",
      "type": "array",
      "items": {
        "description": "A trigger that will start the automation",
        "type": "object",
        "properties": {
          "id": {
            "description": "An ID that can be used in the automation to determine which trigger caused the automation to start.",
            "type": "string"
          },
          "variables": {
            "description": "Variables that will be available in the conditions and action sequence.",
            "type": "object",
            "default": {},
            "patternProperties": {
              ".+": {
                "description": "A variable. Any YAML is valid. Templates can also be used to pass a value to the variable."
              }
            }
          }
        }
      }
    },
    "condition": {
      "oneOf": [
        {
          "description": "A condition template that has to be 'true' to start the automation.",
          "$ref": "defs.schema.json#/$defs/template_string"
        },
        {
          "description": "Conditions that have to be 'true' to start the automation. By default all conditions listed have to be 'true', you can use logical conditions to change this default behavior.",
          "type": "array",
          "items": {
            "description": "A condition that has to be 'true' to start the automation.",
            "$ref": "condition.schema.json"
          }
        }
      ]
    },
    "action": {
      "description": "The sequence of actions to be performed in the script.",
      "type": "array",
      "items": {
        "description": "An action to be performed in the automation",
        "type": "object"
      }
    }
  },
  "required": [
    "blueprint",
    "trigger",
    "action"
  ]
}
